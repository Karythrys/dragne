(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))p(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const I of f.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&p(I)}).observe(document,{childList:!0,subtree:!0});function m(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerPolicy&&(f.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?f.credentials="include":i.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function p(i){if(i.ep)return;i.ep=!0;const f=m(i);fetch(i.href,f)}})();const o=40,B=3,J=.01;class d{x;y;constructor(s,m){this.x=s,this.y=m}}async function _(y){const s=y.getContext("2d",{alpha:!0}),m=Math.floor(y.width/o),p=Math.floor(y.height/o),i=document.querySelector("#eaten"),f=document.querySelector("#longnehead"),I=document.querySelector("#longnelegs"),F=document.querySelector("#longnetail"),E=document.querySelector("#longneturn"),G=document.querySelector("#smork"),H=document.querySelector("#orange"),W=document.querySelector("#dragneghost"),j=document.querySelector("#restart");let M=performance.now(),C=M,u=1,O=1,L=0,A=!1,R=1,T=!1,P=!1;const g=Array(m*p).fill("").map((e,t)=>new d(t%m,Math.floor(t/p))),b=[new d((m??0)>>1,p>>1),new d(((m??0)>>1)+1,p>>1)],v=[];function q(e){return new d(e.x*o,e.y*o)}function D(){return g[Math.floor(Math.random()*g.length)]}function z(e){const t=v.findIndex(n=>n.x===e.x&&n.y===e.y);if(t===-1)return!1;A=!0,L++,i.innerText=`${L}`,R=Math.log(L+1)+1,g.push(v.at(t)),v.splice(t,1);const a=D(),h=g.findIndex(n=>n===a);return g.splice(h,1),v.push(a),!0}function S(e,t){return e.x===t.x-1&&e.y===t.y?1:e.x===t.x&&e.y===t.y-1?2:e.x===t.x+1&&e.y===t.y?3:e.x===t.x&&e.y===t.y+1?4:0}function K(e,t){if(t===0||t===e.length-1)return 0;const a=e.at(t-1),h=e.at(t),n=e.at(t+1),c=S(h,a),r=S(h,n);return c===1&&r===3?1:c===2&&r===4?2:c===3&&r===1?3:c===4&&r===2?4:c===4&&r===1||r===4&&c===1?-1:c===2&&r===1||r===2&&c===1?-2:c===2&&r===3||r===2&&c===3?-3:c===4&&r===3||r===4&&c===3?-4:0}function k(e,t){if(e===3)return s?.rotate(0);s?.translate(t.x+(o>>1),t.y+(o>>1)),e===4&&s?.rotate(Math.PI*.5),e===1&&s?.rotate(Math.PI),e===2&&s?.rotate(Math.PI*1.5),s?.translate(-(t.x+(o>>1)),-(t.y+(o>>1)))}function U(e){if(e.length<2)throw new Error;const t=e.at(0);if(t===void 0)throw new Error;const a=q(t),h=S(e.at(1),t);k(h,a),s?.drawImage(A?G:f,a.x,a.y,o,o),s?.setTransform(1,0,0,1,0,0);for(let w=1;w<e.length-1;w++){const x=e.at(w);if(x===void 0)throw new Error;const l=q(x),$=K(e,w);switch($){case-1:{k(1,l),s?.drawImage(E,l.x,l.y,o,o);break}case-2:{k(2,l),s?.drawImage(E,l.x,l.y,o,o);break}case-3:{k(3,l),s?.drawImage(E,l.x,l.y,o,o);break}case-4:{k(4,l),s?.drawImage(E,l.x,l.y,o,o);break}default:{if($===0)break;k($,l),s?.drawImage(I,l.x,l.y,o,o);break}}s?.setTransform(1,0,0,1,0,0)}const n=e.at(e.length-1);if(n===void 0)throw new Error;const c=q(n),r=S(n,e.at(e.length-2));k(r,c),s?.drawImage(F,c.x,c.y,o,o),s?.setTransform(1,0,0,1,0,0)}function Z(e){for(const t of e){const a=q(t);s?.drawImage(H,a.x+(o>>2),a.y+(o>>2),o>>1,o>>1)}}for(const e of b){const t=g.findIndex(a=>a.x===e.x&&a.y===e.y);t!==-1&&g.splice(t,1)}for(let e=0;e<B;e++){const t=D(),a=g.findIndex(h=>h===t);if(a===-1)throw new Error;g.splice(a,1),v.push(t)}window.addEventListener("keydown",e=>{switch(e.key){case"d":case"D":case"ArrowRight":{u=1;break}case"w":case"W":case"ArrowUp":{u=2;break}case"a":case"A":case"ArrowLeft":{u=3;break}case"s":case"S":case"ArrowDown":{u=4;break}}}),j.addEventListener("click",()=>{P=!0});function N(e){if(P){P=!1,_(y);return}const t=(e-M)/1e3,a=(e-C)/1e3,h=1/R;if(!T&&a>h){C=e;const n=b.at(0);if(n===void 0)throw new Error;const c=S(b.at(1),n);let r;switch(c){case 1:{if(u===2){r=new d(n.x,n.y-1);break}if(u===4){r=new d(n.x,n.y+1);break}r=new d(n.x+1,n.y);break}case 2:{if(u===1){r=new d(n.x+1,n.y);break}if(u===3){r=new d(n.x-1,n.y);break}r=new d(n.x,n.y+1);break}case 3:{if(u===2){r=new d(n.x,n.y-1);break}if(u===4){r=new d(n.x,n.y+1);break}r=new d(n.x-1,n.y);break}case 4:{if(u===1){r=new d(n.x+1,n.y);break}if(u===3){r=new d(n.x-1,n.y);break}r=new d(n.x,n.y-1);break}}if(r===void 0)throw new Error;if(r.x<0||r.x>=m||r.y<0||r.y>=p||b.findIndex(w=>w.x===r.x&&w.y===r.y)!==-1)T=!0;else{if(A=!1,!z(r)){const x=b.pop();x!==void 0&&!(x.x===r.x&&x.y===r.y)&&g.push(x)}const w=g.findIndex(x=>x.x===r.x&&x.y===r.y);if(w===-1)throw new Error;g.splice(w,1),b.unshift(r)}}if(s?.clearRect(0,0,y.width,y.height),U(b),Z(v),T){O<4&&(O+=J*t),O>=4&&(O=4);const n=o*O;s?.drawImage(W,(y.width>>1)-n/2,(y.height>>1)-n/2,n,n)}requestAnimationFrame(N)}N(M)}const Q="./longnehead.png",V="./longnelegs.png",X="./longneneck.png",Y="./longnetail.png",ee="./longneturn.png",ne="./smork.png",te="./orange.svg",re="./dragneghost.webp";window.addEventListener("load",()=>{document.querySelector("#app").innerHTML=`
        <div style="display: none;" >
            <img id="longnehead" src=${Q} >
            <img id="longnelegs" src=${V} >
            <img id="longneneck" src=${X} >
            <img id="longnetail" src=${Y} >
            <img id="longneturn" src=${ee} >
            <img id="smork" src=${ne} >
            <img id="orange" src=${te} >
            <img id="dragneghost" src=${re} >
        </div>
        <div style="border: 1px solid black; background-color: teal; padding: 8px; display: flex; flex-direction: row; justify-content: space-between;" >
            <div style="display: flex; flex-direction: column; align-items: start;" >
                <div>Oranges eaten: <span id="eaten">0</span></div>
                <div>WASD or arrow keys to navigate.</div>
            </div>
            <button id="restart">Restart</button>
        </div>
        <canvas id="dragne-game" width="520" height="520" style="border: 1px solid blue" ></canvas>
    `,_(document.querySelector("#dragne-game"))});

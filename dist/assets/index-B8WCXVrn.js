(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))p(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const v of f.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&p(v)}).observe(document,{childList:!0,subtree:!0});function m(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerPolicy&&(f.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?f.credentials="include":i.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function p(i){if(i.ep)return;i.ep=!0;const f=m(i);fetch(i.href,f)}})();const o=40,B=3,J=.01;class d{x;y;constructor(s,m){this.x=s,this.y=m}}async function _(y){const s=y.getContext("2d",{alpha:!0}),m=Math.floor(y.width/o),p=Math.floor(y.height/o),i=document.querySelector("#eaten"),f=document.querySelector("#longnehead"),v=document.querySelector("#longnelegs"),F=document.querySelector("#longnetail"),E=document.querySelector("#longneturn"),G=document.querySelector("#smork"),H=document.querySelector("#orange"),W=document.querySelector("#dragneghost"),j=document.querySelector("#restart");let M=performance.now(),R=M,u=1,I=1,L=0,A=!1,D=1,T=!1,P=!1;const g=Array(m*p).fill("").map((e,r)=>new d(r%m,Math.floor(r/p))),b=[new d((m??0)>>1,p>>1),new d(((m??0)>>1)+1,p>>1)],O=[];function q(e){return new d(e.x*o,e.y*o)}function $(){return g[Math.floor(Math.random()*g.length)]}function z(e){const r=O.findIndex(n=>n.x===e.x&&n.y===e.y);if(r===-1)return!1;A=!0,L++,i.innerText=`${L}`,D=Math.log(L+1)+1,g.push(e),O.splice(r,1);let a=$();for(;a.x===e.x&&a.y===e.y;)a=$();const h=g.findIndex(n=>n===a);return g.splice(h,1),O.push(a),!0}function S(e,r){return e.x===r.x-1&&e.y===r.y?1:e.x===r.x&&e.y===r.y-1?2:e.x===r.x+1&&e.y===r.y?3:e.x===r.x&&e.y===r.y+1?4:0}function K(e,r){if(r===0||r===e.length-1)return 0;const a=e.at(r-1),h=e.at(r),n=e.at(r+1),c=S(h,a),t=S(h,n);return c===1&&t===3?1:c===2&&t===4?2:c===3&&t===1?3:c===4&&t===2?4:c===4&&t===1||t===4&&c===1?-1:c===2&&t===1||t===2&&c===1?-2:c===2&&t===3||t===2&&c===3?-3:c===4&&t===3||t===4&&c===3?-4:0}function k(e,r){if(e===3)return s?.rotate(0);s?.translate(r.x+(o>>1),r.y+(o>>1)),e===4&&s?.rotate(Math.PI*.5),e===1&&s?.rotate(Math.PI),e===2&&s?.rotate(Math.PI*1.5),s?.translate(-(r.x+(o>>1)),-(r.y+(o>>1)))}function U(e){if(e.length<2)throw new Error;const r=e.at(0);if(r===void 0)throw new Error;const a=q(r),h=S(e.at(1),r);k(h,a),s?.drawImage(A?G:f,a.x,a.y,o,o),s?.setTransform(1,0,0,1,0,0);for(let w=1;w<e.length-1;w++){const x=e.at(w);if(x===void 0)throw new Error;const l=q(x),C=K(e,w);switch(C){case-1:{k(1,l),s?.drawImage(E,l.x,l.y,o,o);break}case-2:{k(2,l),s?.drawImage(E,l.x,l.y,o,o);break}case-3:{k(3,l),s?.drawImage(E,l.x,l.y,o,o);break}case-4:{k(4,l),s?.drawImage(E,l.x,l.y,o,o);break}default:{if(C===0)break;k(C,l),s?.drawImage(v,l.x,l.y,o,o);break}}s?.setTransform(1,0,0,1,0,0)}const n=e.at(e.length-1);if(n===void 0)throw new Error;const c=q(n),t=S(n,e.at(e.length-2));k(t,c),s?.drawImage(F,c.x,c.y,o,o),s?.setTransform(1,0,0,1,0,0)}function Z(e){for(const r of e){const a=q(r);s?.drawImage(H,a.x+(o>>2),a.y+(o>>2),o>>1,o>>1)}}for(const e of b){const r=g.findIndex(a=>a.x===e.x&&a.y===e.y);r!==-1&&g.splice(r,1)}for(let e=0;e<B;e++){const r=$(),a=g.findIndex(h=>h===r);if(a===-1)throw new Error;g.splice(a,1),O.push(r)}window.addEventListener("keydown",e=>{switch(e.key){case"d":case"D":case"ArrowRight":{u=1;break}case"w":case"W":case"ArrowUp":{u=2;break}case"a":case"A":case"ArrowLeft":{u=3;break}case"s":case"S":case"ArrowDown":{u=4;break}}}),j.addEventListener("click",()=>{P=!0});function N(e){if(P){P=!1,_(y);return}const r=(e-M)/1e3,a=(e-R)/1e3,h=1/D;if(!T&&a>h){R=e;const n=b.at(0);if(n===void 0)throw new Error;const c=S(b.at(1),n);let t;switch(c){case 1:{if(u===2){t=new d(n.x,n.y-1);break}if(u===4){t=new d(n.x,n.y+1);break}t=new d(n.x+1,n.y);break}case 2:{if(u===1){t=new d(n.x+1,n.y);break}if(u===3){t=new d(n.x-1,n.y);break}t=new d(n.x,n.y+1);break}case 3:{if(u===2){t=new d(n.x,n.y-1);break}if(u===4){t=new d(n.x,n.y+1);break}t=new d(n.x-1,n.y);break}case 4:{if(u===1){t=new d(n.x+1,n.y);break}if(u===3){t=new d(n.x-1,n.y);break}t=new d(n.x,n.y-1);break}}if(t===void 0)throw new Error;if(t.x<0||t.x>=m||t.y<0||t.y>=p||b.findIndex(w=>w.x===t.x&&w.y===t.y)!==-1)T=!0;else{if(A=!1,!z(t)){const x=b.pop();x!==void 0&&!(x.x===t.x&&x.y===t.y)&&g.push(x)}const w=g.findIndex(x=>x.x===t.x&&x.y===t.y);if(w===-1)throw new Error;g.splice(w,1),b.unshift(t)}}if(s?.clearRect(0,0,y.width,y.height),U(b),Z(O),T){I<4&&(I+=J*r),I>=4&&(I=4);const n=o*I;s?.drawImage(W,(y.width>>1)-n/2,(y.height>>1)-n/2,n,n)}requestAnimationFrame(N)}N(M)}const Q="./longnehead.png",V="./longnelegs.png",X="./longneneck.png",Y="./longnetail.png",ee="./longneturn.png",ne="./smork.png",te="./orange.svg",re="./dragneghost.webp";window.addEventListener("load",()=>{document.querySelector("#app").innerHTML=`
        <div style="display: none;" >
            <img id="longnehead" src=${Q} >
            <img id="longnelegs" src=${V} >
            <img id="longneneck" src=${X} >
            <img id="longnetail" src=${Y} >
            <img id="longneturn" src=${ee} >
            <img id="smork" src=${ne} >
            <img id="orange" src=${te} >
            <img id="dragneghost" src=${re} >
        </div>
        <div style="border: 1px solid black; background-color: teal; padding: 8px; display: flex; flex-direction: row; justify-content: space-between;" >
            <div style="display: flex; flex-direction: column; align-items: start;" >
                <div>Oranges eaten: <span id="eaten">0</span></div>
                <div>WASD or arrow keys to navigate.</div>
            </div>
            <button id="restart">Restart</button>
        </div>
        <canvas id="dragne-game" width="520" height="520" style="border: 1px solid blue" ></canvas>
    `,_(document.querySelector("#dragne-game"))});
